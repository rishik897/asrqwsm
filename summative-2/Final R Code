library(dplyr)
library("GGally")
library("car")
library("ggpubr")
library("ggplot2")

employee <- read.csv("Employee_Performance.csv")
employee <- employee %>% 
  mutate(across(c(Expertise,Level,Type), factor))

class(employee$Expertise)
class(employee$Level)
class(employee$Type)

View(employee)

summary(employee)

ggpairs(employee)

model_1 <- lm(employee$Sales_Perf ~ ., data = employee)
summary(model_1)

model_2 <- lm(employee$Sales_Perf ~ employee$Creativity + employee$Mechanical +  employee$Maths + employee$Type + employee$Level + employee$Expertise, data = employee)
summary(model_2)

model_3 <- lm(employee$Sales_Perf ~ employee$Mechanical +  employee$Maths + employee$Type + employee$Level + employee$Expertise, data = employee)
summary(model_3)


step(model_1)

drop1(model_3, test = "F")

qf(0.95, 7, 48)

residuals(model_3)

employee$residuals <- residuals(model_3)
employee$predicted <- fitted.values(model_3)

View(employee)

qplot(fitted.values(model_3), residuals(model_3)) + geom_smooth(method = "lm", se = FALSE) #not much bias because the scatter plot is a cluster. 




# Question 2
diabetes <- read.csv("Diabetes.csv")
View(diabetes)

diabetes <- diabetes %>% 
  mutate(across(c(Diabetes,HighBP,HighChol,Smoker,Fruits), factor)) %>% 
  mutate(Age = as.integer(Age),
         BMI = as.numeric(BMI))

summary(diabetes)

ggpairs(diabetes)

ggboxplot(diabetes, x = "Diabetes", y = "Age",
          bxp.errorbar = TRUE,
          add = "mean")

ggboxplot(diabetes, x = "Diabetes", y = "BMI",
          bxp.errorbar = TRUE,
          add = "mean")

diabetesbar <- diabetes %>% 
  group_by(HighBP, Diabetes) %>% 
  summarise(count = n())
View(diabetesbar)

ggplot(diabetesbar, aes(x = HighBP, y = count, fill = Diabetes)) + geom_bar(stat = "identity", position = "dodge")+ ylab("Total")

diabeteschol <- diabetes %>% 
  group_by(HighChol, Diabetes) %>% 
  summarise(count = n())
View(diabeteschol)

ggplot(diabeteschol, aes(x = HighChol, y = count, fill = Diabetes)) + geom_bar(stat = "identity", position = "dodge")+ ylab("Total")

diabetessmoke <- diabetes %>% 
  group_by(Smoker, Diabetes) %>% 
  summarise(count = n())
View(diabetessmoke)

ggplot(diabetessmoke, aes(x = Smoker, y = count, fill = Diabetes)) + geom_bar(stat = "identity", position = "dodge")+ ylab("Total")


diabetesfru <- diabetes %>% 
  group_by(Fruits, Diabetes) %>% 
  summarise(count = n())
View(diabetesfru)

ggplot(diabetesfru, aes(x = Fruits, y = count, fill = Diabetes)) + geom_bar(stat = "identity", position = "dodge") + ylab("Total")


set.seed(123)
split_idx = sample(nrow(diabetes), 120)
diabetes_train = diabetes[split_idx, ]
diabetes_test = diabetes[-split_idx, ]

summary(diabetes_train)


# Model Selection
model4 <- glm(Diabetes ~ HighBP + HighChol + BMI + Fruits + Smoker + Age, data = diabetes_train, family = binomial(logit))
summary(model4)


diabetessum <- diabetes %>% 
  arrange(Diabetes) %>%
  filter(Diabetes == 1) %>% 
  select(Diabetes,BMI)

diabetessum2 <- diabetes %>% 
  arrange(Diabetes) %>%
  filter(Diabetes == 0) %>% 
  select(Diabetes,BMI)

View(diabetessum)

diabetessum3 <- diabetes %>% 
  arrange(Diabetes) %>% 
  filter(Diabetes == 1) %>% 
  select(Diabetes, Age)

diabetessum4 <- diabetes %>% 
  arrange(Diabetes) %>% 
  filter(Diabetes == 0) %>% 
  select(Diabetes, Age)
  

summary(diabetessum)
summary(diabetessum2)
summary(diabetessum3)
summary(diabetessum4)


G_Calc <- model4$null.deviance - model4$deviance
Gdf <- model4$df.null - model4$df.residual

G_Calc

qchisq(0.95, df = Gdf)

1-pchisq(G_Calc, Gdf)



anova(model4, test = "Chisq")

model5 <- glm(Diabetes ~ HighBP + HighChol + BMI + Fruits + Age, data = diabetes_train, family = binomial(logit))
summary(model5)
anova(model5, test = "Chisq")

model6 <- glm(Diabetes ~ HighBP + HighChol + BMI + Age, data = diabetes_train, family = binomial(logit))
summary(model6)
anova(model6, test = "Chisq")




# Accuracy
round(predict(model6, diabetes_test, type = "response"),2)

t(diabetes_test$Diabetes)

coefficients(model6)

how_well <- data.frame(fit, diabetes_test$Diabetes) %>% 
  mutate(result = round(fit) == diabetes_test$Diabetes)

how_well

confusion_matrix <- table(diabetes_test$Diabetes, round(fit))
confusion_matrix

accuracy <- function(x) {
  sum(diag(x)/sum(rowSums(x)))*100
}

accuracy(confusion_matrix)
